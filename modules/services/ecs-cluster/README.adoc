:type: service
:name: Amazon ECS Cluster
:description: Deploy an Amazon ECS Cluster
:icon: /_docs/ecs-cluster-icon.png
:category: docker-orchestration
:cloud: aws
:tags: docker, orchestration, ecs, containers
:license: gruntwork
:built-with: terraform, bash, python, go

// AsciiDoc TOC settings
:toc:
:toc-placement!:
:toc-title:

// GitHub specific settings. See https://gist.github.com/dcode/0cfbf2699a1fe9b46ff04c41721dda74 for details.
ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
endif::[]

= Amazon ECS

image:https://img.shields.io/badge/maintained%20by-gruntwork.io-%235849a6.svg[link="https://gruntwork.io/?ref=repo_aws_service_catalog"]
image:https://img.shields.io/badge/tf-%3E%3D0.12.0-blue.svg[Terraform version]

This folder contains https://www.terraform.io[Terraform] code to deploy a production-grade ECS cluster on https://aws.amazon.com[AWS] using
https://docs.aws.amazon.com/AmazonECS/latest/developerguide/Welcome.html[Elastic
Container Service (ECS)].

This module launches an ECS cluster on top of an Auto Scaling Group that you manage. If you wish to launch an ECS
cluster on top of Fargate that is completely managed by AWS, refer to the
link:../ecs-fargate-cluster[ecs-fargate-cluster module]. Refer to the section
https://github.com/gruntwork-io/terraform-aws-ecs/blob/master/core-concepts.md#ec2-vs-fargate-launch-types[EC2 vs
Fargate Launch Types] for more information on the differences between the two flavors.

image::/_docs/ecs-architecture.png?raw=true[ECS architecture]

toc::[]




== Features

This Terraform Module launches an link:http://docs.aws.amazon.com/AmazonECS/latest/developerguide/ECS_clusters.html[EC2 Container Service
Cluster] that you can use to run Docker containers. The cluster consists of a configurable number of instances in an Auto
Scaling Group (ASG). Each instance:

*  Runs the link:http://docs.aws.amazon.com/AmazonECS/latest/developerguide/ECS_agent.html[ECS Container Agent] so
   it can communicate with the ECS scheduler.
*  Authenticates with a Docker repo so it can download private images. The Docker repo auth details should be encrypted
   using link:https://aws.amazon.com/kms/[Amazon Key Management Service (KMS)] and passed in as input variables. The
   instances, when booting up, will use link:https://github.com/gruntwork-io/gruntkms[gruntkms] to decrypt the data
   in-memory. Note that the IAM role for these instances, which uses `var.cluster_name` as its name, must be granted
   access to the link:http://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#master_keys[Customer Master Key (CMK)]
   used to encrypt the data.
*  Runs the link:http://docs.aws.amazon.com/AmazonCloudWatch/latest/DeveloperGuide/QuickStartEC2Instance.html[CloudWatch Logs Agent]
   to send all logs in syslog to link:http://docs.aws.amazon.com/AmazonCloudWatch/latest/DeveloperGuide/WhatIsCloudWatchLogs.html[CloudWatch Logs].
   This is configured using the link:https://github.com/gruntwork-io/terraform-aws-monitoring/tree/master/modules/logs/cloudwatch-log-aggregation-scripts[cloudwatch-log-aggregation-scripts module].
*  Emits custom metrics that are not available by default in CloudWatch, including memory and disk usage. This is
   configured using the link:https://github.com/gruntwork-io/terraform-aws-monitoring/tree/master/modules/metrics/cloudwatch-memory-disk-metrics-scripts[cloudwatch-memory-disk-metrics-scripts module].
*  Runs the link:https://github.com/gruntwork-io/terraform-aws-monitoring/tree/master/modules/logs/syslog[syslog module] to
   automatically rotate and rate limit syslog so that your instances don't run out of disk space from large volumes of
   logs.
*  Runs the link:https://github.com/gruntwork-io/terraform-aws-security/tree/master/modules/ssh-grunt[ssh-grunt module] so that
   developers can upload their public SSH keys to IAM and use those SSH keys, along with their IAM user names, to SSH
   to the ECS Nodes.
*  Runs the link:https://github.com/gruntwork-io/terraform-aws-security/tree/master/modules/auto-update[auto-update module] so
   that the ECS nodes install security updates automatically.


== Learn

NOTE: This repo is a part of the https://github.com/gruntwork-io/terraform-aws-service-catalog/[Gruntwork Service Catalog], a collection of
reusable, battle-tested, production ready infrastructure code. If you've never used the Service Catalog before, make
sure to read https://gruntwork.io/guides/foundations/how-to-use-gruntwork-service-catalog/[How to use the Gruntwork
Service Catalog]!

Under the hood, this is all implemented using Terraform modules from the Gruntwork
https://github.com/gruntwork-io/terraform-aws-ecs[module-ecs] repo. If you don't have access to this repo, email
support@gruntwork.io.


=== Core concepts

To understand core concepts like what is ECS, and the different cluster types, see the documentation in the
https://github.com/gruntwork-io/terraform-aws-ecs[ecs module] repo.

To use ECS, you first deploy one or more EC2 Instances into a "cluster". The ECS scheduler can then deploy Docker
containers across any of the instances in this cluster. Each instance needs to have the
link:http://docs.aws.amazon.com/AmazonECS/latest/developerguide/ECS_agent.html[Amazon ECS Agent] installed so it can communicate with
ECS and register itself as part of the right cluster.

For more info on ECS clusters, including how to run Docker containers in a cluster, how to add additional security
group rules, how to handle IAM policies, and more, check out the
link:https://github.com/gruntwork-io/terraform-aws-ecs/tree/master/modules/ecs-cluster[ecs-cluster documentation] in the
link:https://github.com/gruntwork-io/terraform-aws-ecs[terraform-aws-ecs repo].

For info on finding your Docker container logs in CloudWatch, check out the
link:https://github.com/gruntwork-io/terraform-aws-monitoring/tree/master/modules/logs/cloudwatch-log-aggregation-scripts[cloudwatch-log-aggregation-scripts documentation].
For info on viewing the custom metrics in CloudWatch, check out the
link:https://github.com/gruntwork-io/terraform-aws-monitoring/tree/master/modules/metrics/cloudwatch-memory-disk-metrics-scripts[cloudwatch-memory-disk-metrics-scripts documentation].

=== Repo organization

* link:/modules[modules]: the main implementation code for this repo, broken down into multiple standalone, orthogonal submodules.
* link:/examples[examples]: This folder contains working examples of how to use the submodules.
* link:/test[test]: Automated tests for the modules and examples.


== Deploy

=== Non-production deployment (quick start for learning)

If you just want to try this repo out for experimenting and learning, check out the following resources:

* link:/examples/for-learning-and-testing[examples/for-learning-and-testing folder]: The
  `examples/for-learning-and-testing` folder contains standalone sample code optimized for learning, experimenting, and
  testing (but not direct production usage).

=== Production deployment

If you want to deploy this repo in production, check out the following resources:

* link:/examples/for-production[examples/for-production folder]: The `examples/for-production` folder contains sample
  code optimized for direct usage in production. This is code from the
  https://gruntwork.io/reference-architecture/:[Gruntwork Reference Architecture], and it shows you how we build an
  end-to-end, integrated tech stack on top of the Gruntwork Service Catalog.




== Manage

For information on how to manage your ECS cluster, see the documentation in the
https://github.com/gruntwork-io/terraform-aws-ecs[module ecs] repo.




== Contributions

Contributions to this repo are very welcome and appreciated! If you find a bug or want to add a new feature or even contribute an entirely new module, we are very happy to accept pull requests, provide feedback, and run your changes through our automated test suite.

Please see https://gruntwork.io/guides/foundations/how-to-use-gruntwork-infrastructure-as-code-library/#contributing-to-the-gruntwork-infrastructure-as-code-library[Contributing to the Gruntwork Infrastructure as Code Library] for instructions.




== License

Please see link:/LICENSE.txt[LICENSE.txt] for details on how the code in this repo is licensed.
